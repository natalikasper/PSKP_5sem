<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>CWP25</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css" id="theme">
    <link rel="stylesheet" href="../lib/css/zenburn.css">
    <link rel="stylesheet" href="../css/user.css">
</head>
<body class="yandex nodejs"><div class="reveal"><div class="slides">

  <section class="large">
      <h2>React</h2>
      <p class="author">
          <small>Лекция 25</small>
      </p>
  </section>

  <section>
    <img src="images/react.png" width="400px">
  </section>
  
  <section>
    <h4>React</h4>

    <ul class="left">
      <li class="fragment"><a href="https://facebook.github.io/react/">Оффициальный сайт</a></li>
      <li class="fragment">View библиотека от Facebook</li>
      <li class="fragment">Декларативная</li>
      <li class="fragment">Компонентно-ориентированная</li>
      <li class="fragment">Learn Once, Write Anywhere</li>
    </ul>
  </section>

  <section>
    <h4>React</h4>

    <ul class="left">
      <li class="fragment">Virtual DOM (Document Object Model)</li>
      <li class="fragment">Тестируемость</li>
      <li class="fragment">Переиспользование</li>
      <li class="fragment">Props и State</li>
      <li class="fragment">Чистые компоненты</li>
      <li class="fragment">JSX</li>
    </ul>
  </section>

  <section>
    <h4>React - Sandbox</h4>

    <div class="left">
      <pre class="javascript"><code>
&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;https://unpkg.com/react@16.2.0/umd/react.development.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/react-dom@16.2.0/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/babel-standalone@6.26.0/babel.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/babel-polyfill@6.26.0//dist/polyfill.min.js&quot;&gt;&lt;/script&gt;

&lt;script type=&quot;text/babel&quot;&gt;
  ...
&lt;/script&gt;
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Hello World</h4>

    <div class="left">
      <pre class="javascript"><code>
class App extends React.Component {
  render() {
    return (
      &lt;div&gt;
        Hello from React!
      &lt;/div&gt;
    );
  }
}

ReactDOM.render(
  &lt;App/&gt;,
  document.getElementById('app')
);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Hello World</h4>

    <div class="left">
      <pre class="javascript"><code>
class App extends React.Component {
  render() {
    return React.createElement(
      "div",
      null,
      "Hello from React!"
    );
  }
}

ReactDOM.render(
  React.createElement(App),
  document.getElementById('app')
);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Hello World</h4>

    <div class="left">
      <pre class="javascript"><code>
class App extends React.Component {
  constructor(props) {
    super(props);

    this.click = this.click.bind(this);
  }

  render() {
    return &lt;div onClick={this.click}&gt;Hi&lt;/div&gt;;
  }

  click() { console.log(this.props.title); }
}

ReactDOM.render(&lt;App title='Next Facebook!'/&gt;,
  document.getElementById('app'));
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Hello World</h4>

    <div class="left">
      <pre class="javascript"><code>
class App extends React.Component {
  constuctor(props) {
    super(props);

    this.click = this.click.bind(this);
  }

  render() {
    return &lt;div onClick={this.click}&gt;Hi&lt;/div&gt;
  },

  click() {
    console.log(this.props.title);
  }
});

ReactDOM.render(&lt;App title='Next Facebook!'/&gt;,
  document.getElementById('app'));
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <ul class="left">
      <li class="fragment">абстракция над DOM</li>
      <li class="fragment">приложение работает с VDOM, который после всех изменений сам рассчитывает как более оптимально сделать изменения в DOM</li>
      <li class="fragment">dirty cheking vs observable</li>
    </ul>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <ul class="left">
      <li class="fragment">произошло изменение</li>
      <li class="fragment">сделать снапшот VDOM</li>
      <li class="fragment">сгенерировать новый VDOM</li>
      <li class="fragment">вычислить дельту</li>
      <li class="fragment">внести изменения в DOM</li>
      <li class="fragment"><a href="https://github.com/matt-esch/virtual-dom">matt-esch/virtual-dom</a></li>
    </ul>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <div class="left">
      <pre class="javascript"><code>
const h = require('virtual-dom/h');
const diff = require('virtual-dom/diff');
const patch = require('virtual-dom/patch');
const createElement = require('virtual-dom/create-element');
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <div class="left">
      <pre class="javascript"><code>
function render(count)  {
  return h('div', {
    style: {
      textAlign: 'center',
      lineHeight: (100 + count) + 'px',
      border: '1px solid red',
      width: (100 + count) + 'px',
      height: (100 + count) + 'px'
    }
  }, [String(count)]);
}
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <div class="left">
      <pre class="javascript"><code>
let count = 0;

let tree = render(count);
let rootNode = createElement(tree);
document.body.appendChild(rootNode);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Virtual DOM</h4>

    <div class="left">
      <pre class="javascript"><code>
setInterval(function () {
  count++;

  const newTree = render(count);
  const patches = diff(tree, newTree);
  rootNode = patch(rootNode, patches);
  tree = newTree;
}, 1000);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>JSX</h4>

    <div class="left">
      <pre class="javascript"><code>
const element = &lt;h1&gt;Hello, world!&lt;/h1&gt;;
      </code></pre>
    </div>
  </section>

  <section>
    <h4>JSX</h4>

    <div class="left">
      <pre class="javascript"><code>
function formatName(user) {
  return user.firstName + ' ' + user.lastName;
}

const user = {
  firstName: 'Harper',
  lastName: 'Perez'
};

const element = (
  &lt;h1&gt;
    Hello, {formatName(user)}!
  &lt;/h1&gt;
);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>JSX</h4>

    <div class="left">
      <pre class="javascript"><code>
function getGreeting(user) {
  if (user) {
    return &lt;h1&gt;Hello, {formatName(user)}!&lt;/h1&gt;;
  }
  return &lt;h1&gt;Hello, Stranger.&lt;/h1&gt;;
}
      </code></pre>
    </div>
  </section>

  <section>
    <h4>JSX</h4>

    <div class="left">
      <pre class="javascript"><code>
&lt;MyComponent message={'hello world'} /&gt;
&lt;MyComponent onClick={this._onClick} /&gt;
      </code></pre>
    </div>
  </section>

  <section>
    <h4>JSX</h4>

    <div class="left">
      <pre class="javascript"><code>
&lt;MyContainer&gt;
  &lt;MyFirstComponent /&gt;
  &lt;MySecondComponent /&gt;
&lt;/MyContainer&gt;
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Rendering</h4>

    <div class="left">
      <pre class="javascript"><code>
function tick() {
  const element = (
    &lt;div&gt;
      &lt;h1&gt;Hello, world!&lt;/h1&gt;
      &lt;h2&gt;It is {new Date().toLocaleTimeString()}.&lt;/h2&gt;
    &lt;/div&gt;
  );
  ReactDOM.render(element, document.getElementById(&#39;root&#39;));
}

setInterval(tick, 1000);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Rendering</h4>

    <img src="images/granular-dom-updates.gif">
  </section>

  <section>
    <h4>Props & State</h4>

    <div class="left">
      <pre class="javascript"><code>
function Hello(props) {
  return &lt;h1&gt;Hello, {props.name}&lt;/h1&gt;;
}

ReactDOM.render(
  &lt;Hello name=&quot;Moto&quot;/&gt;,
  document.getElementById('app')
);
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Props & State</h4>

    <div class="left">
      <pre class="javascript"><code>
class Hello extends React.Component {
  render() {
    return &lt;h1&gt;Hello, {this.props.name}&lt;/h1&gt;;
  }
}
      </code></pre>
    </div>
  </section>

  <section>
    <h4>Props & State</h4>

    <div class="left">
      <pre class="javascript"><code>
class Hello extends React.Component {
  constructor(props) {
    super(props);
    this.state = { names: ['Rick', 'Carl', 'Negan'],
      current: 0 };
  }

  componentDidMount() {
    setInterval(() =&gt; { this.setState({
      current: (this.state.current + 1) % 3
    })}, 1000);
  },

  render() {
    return (&lt;div&gt;Hello
      {this.state.names[this.state.current]}!
    &lt;/div&gt;);
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <h3><span class="red">T</span>O-DO LIST</h3>
  </section>

  <section>
    <img src="images/todo-1.png">
  </section>

  <section>
    <img src="images/todo-0.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  constructor() {
    this.list = [];
  }

  getItems() {
    return this.list;
  }

  getActiveItems() {
    return this.list.filter(x => !x.completed);
  }

  getCompletedItems() {
    return this.list.filter(x => x.completed);
  }

  ...
}
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  ...

  getActiveCount() {
    return this.list
        .filter(x => !x.completed)
        .length;
  }

  getCompletedCount() {
    return this.list
        .filter(x => x.completed)
        .length;
  }

  ...
}
      </code></pre>
    </div>
  </section>

  <section>
  <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  ...

  addItem(text) {
    let item = {
      id: Date.now() + this.list.length,
      text: text,
      completed: false
    };

    this.list.push(item);

    return item;
  }

  ...
}
      </code></pre>
  </div>
</section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  ...

  removeItem(id) {
    let index = this.list
      .findIndex(x => x.id === id);

    this.list.splice(index, 1);
  }

  removeCompleted() {
    this.list = this.getActiveItems();
  }

  ...
}
      </code></pre>
    </div>
  </section>

  <section>
  <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  ...

  updateItem(id, text) {
    let index = this.list
      .findIndex(x => x.id === id);

    this.list[index].text = text;
  }

  toggleItem(id) {
    let index = this.list
      .findIndex(x => x.id === id);

    this.list[index].completed
      = !this.list[index].completed;
  }

  ...
}
      </code></pre>
  </div>
</section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoModel {
  ...

  switchAllTo(completed) {
    this.list
      .forEach(x => x.completed = completed);
  }
}
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class NavModel {
  constructor() {
    this.links = [
      { title: 'All' },
      { title: 'Active' },
      { title: 'Completed' }
    ];

    this.active = this.links[0];
  }

  ...
}
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class NavModel {
  ...

  getLinks() {
    return this.links;
  }

  getActive() {
    return this.active;
  }

  setActive(link) {
    this.active = link;
  }
}
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-2.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  constructor(props) {
    super(props);

    this._rerender = this._rerender.bind(this);
    this._toggleItem = this._toggleItem.bind(this);
    this._toogleAll = this._toogleAll.bind(this);
    this._removeItem = this._removeItem.bind(this);
    this._addItem = this._addItem.bind(this);
    this._updateItem = this._updateItem.bind(this);
    this._removeCompleted = this._removeCompleted.bind(this);
    this._navigate = this._navigate.bind(this);

    this.state = this._getState();
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  render() {
    return (
      &lt;div className=&quot;todo&quot;&gt;
        ...
      &lt;/div&gt;
    );
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
&lt;div className=&quot;todo&quot;&gt;
  &lt;div className=&quot;todo__title&quot;&gt;React ToDo&lt;/div&gt;
  &lt;Nav links={this.state.links}
      activeLink={this.state.activeLink}
      navigate={this._navigate}/&gt;
  &lt;ToDoSummary remains={this.state.remains}
      completed={this.state.completed}/&gt;
  &lt;ToDoList tasks={this.state.tasks}
      areAllComplete={this.state.areAllCompleted}
      toggleItem={this._toggleItem}
      toggleAll={this._toogleAll}
      removeItem={this._removeItem}
      updateItem={this._updateItem}
  /&gt;
  &lt;ToDoForm addItem={this._addItem}/&gt;
  &lt;ToDoClear
      removeCompleted={this._removeCompleted}/&gt;
&lt;/div&gt;
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _rerender() {
    this.setState(this._getState());
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _getState() {
    const state = {
      remains: todoModel.getActiveCount(),
      completed: todoModel.getCompletedCount(),

      links: navModel.getLinks(),
      activeLink: navModel.getActive()
    };

    state.areAllCompleted = state.remains === 0;
    ...
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _getState() {
    ...
    if (state.activeLink.title === 'All') {
      state.tasks = todoModel.getItems();
    } else if (state.activeLink.title === 'Completed') {
      state.tasks = todoModel.getCompletedItems();
    } else {
      state.tasks = todoModel.getActiveItems();
    }

    return state;
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _toggleItem(id) {
    todoModel.toggleItem(id);
    this._rerender();
  }

  _toogleAll() {
    todoModel.switchAllTo(!this.state.areAllCompleted);
    this._rerender();
  }

  _removeItem(id) {
    todoModel.removeItem(id);
    this._rerender();
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _addItem(text) {
    todoModel.addItem(text);
    this._rerender();
  }

  _updateItem(id, text) {
    todoModel.updateItem(id, text);
    this._rerender();
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDo extends React.Component {
  ...
  _removeCompleted() {
    todoModel.removeCompleted();
    this._rerender();
  }

  _navigate(link) {
    navModel.setActive(link);
    this._rerender();
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-3.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class Nav extends React.Component {
  render() {
    const items = this.props.links.map((link) =&gt; {
      return (
        &lt;NavItem key={link.title}
            link={link}
            navigate={this.props.navigate}
            isActive={link.title
                === this.props.activeLink.title}
        /&gt;
      )
    });

    return (
        &lt;div className=&quot;nav&quot;&gt;
          {items}
        &lt;/div&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-4.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class NavItem extends React.Component {
  constructor(props) {
    super(props);

    this._navigate = this._navigate.bind(this);
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class NavItem extends React.Component {
  ...
  render() {
    return (
      &lt;div className={'nav__item'
          + (this.props.isActive
            ? ' nav__item_active' : '')}
          onClick={this._navigate}&gt;

        {this.props.link.title}

      &lt;/div&gt;
    );
  },

  _navigate() {
    this.props.navigate(this.props.link)
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-5.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoSummary extends React.Component {
  render() {
    return (
      &lt;div className=&quot;todo-info&quot;&gt;
        &lt;span className=&quot;todo-info__remains&quot;&gt;
          {this.props.remains} remains
        &lt;/span&gt;
        {' '}
        &lt;span className=&quot;todo-info__completed&quot;&gt;
          / {this.props.completed} completed
        &lt;/span&gt;
      &lt;/div&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-6.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoList extends React.Component {
  render() {
    const items = this.props.tasks.map((task) =&gt; {
      return (
        &lt;ToDoItem key={task.id}
            task={task}
            toggleItem={this.props.toggleItem}
            removeItem={this.props.removeItem}
            updateItem={this.props.updateItem}
        /&gt;
      );
    });
    ...
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoList extends React.Component {
  render() {
    ...
    return (
      &lt;div className=&quot;todo__list&quot;&gt;
        &lt;div className=&quot;todo__toggle-all&quot;&gt;
          &lt;input type=&quot;checkbox&quot;
              className=&quot;todo__checkbox&quot;
              checked={this.props.areAllComplete}
              onChange={this.props.toggleAll}/&gt;
          {' '}
          Complete all
        &lt;/div&gt;

        {items}
      &lt;/div&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-7.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoItem extends React.Component {
  constructor(props) {
    super(props);

    this._edit = this._edit.bind(this);
    this._save = this._save.bind(this);
    this._toggleItem = this._toggleItem.bind(this);
    this._removeItem = this._removeItem.bind(this);

    this.state = {
      isEditing: false
    };
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoItem extends React.Component {
  ...
  _edit() {
    this.setState({ isEditing: true });
  }

  _save(text) {
    this.setState({ isEditing: false });
    this.props.updateItem(
      this.props.task.id,
      text
    );
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoItem extends React.Component {
  ...
  _toggleItem() {
    this.props.toggleItem(this.props.task.id);
  }

  _removeItem() {
    this.props.removeItem(this.props.task.id);
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoItem extends React.Component {
  ...
  render() {
    const text = this.state.isEditing ? (
      &lt;ToDoTextInput
        className=&quot;todo__text todo__text_editing&quot;
        text={this.props.task.text}
        onSave={this._save}/&gt;
      )
      : (&lt;span className={'todo__text'
            + (this.props.task.completed
            ? ' todo__text_completed' : '')}
          onDoubleClick={this._edit}&gt;
          {this.props.task.text}
        &lt;/span&gt;
      );
      ...
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoItem extends React.Component {
  ...
  render() {
    ...
    return (
      &lt;div className=&quot;todo__item&quot;&gt;
        &lt;input type=&quot;checkbox&quot;
          className=&quot;todo__checkbox&quot;
          checked={this.props.task.completed}
          onChange={this._toggleItem}/&gt;
        &lt;span className=&quot;todo__destroy&quot;
          onClick={this._removeItem}&gt;-&lt;/span&gt;
        {' '}
        {text}
      &lt;/div&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-8.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoForm extends React.Component {
  constructor(props) {
    super(props);

    this._save = this._save.bind(this);
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoForm extends React.Component {
  ...
  render() {
    return (
      &lt;div className=&quot;todo__form&quot;&gt;
        &lt;ToDoTextInput
            className=&quot;todo__text-input&quot;
            placeholder=&quot;I need to do...&quot;
            onSave={this._save}
        /&gt;
      &lt;/div&gt;
    );
  },

  _save(text) {
    this.props.addItem(text);
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-9.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoTextInput extends React.Component {
  constructor(props) {
    super(props);

    this._save = this._save.bind(this);
    this._onChange = this._onChange.bind(this);
    this._onKeyDown = this._onKeyDown.bind(this);

    this.state = {
      text: this.props.text ? this.props.text : ''
    };
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoTextInput extends React.Component {
  ...
  _save: function() {
    this.props.onSave(this.state.text);
    this.setState({ text: '' });
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoTextInput extends React.Component {
  ...
  _onChange: function(event) {
    this.setState({
      text: event.target.value
    });
  }

  _onKeyDown: function(event) {
    if (event.keyCode !== 13) return;

    this._save();
  }
  ...
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoTextInput extends React.Component {
  ...
  render() {
    return (
      &lt;input className={this.props.className}
        placeholder={this.props.placeholder}
        value={this.state.text}
        onChange={this._onChange}
        onKeyDown={this._onKeyDown}/&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <img src="images/todo-10.png">
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
class ToDoClear extends React.Component {
  render() {
    return (
      &lt;div className=&quot;todo__clear&quot;
           onClick={this.props.removeCompleted}&gt;
        Clear
      &lt;/div&gt;
    );
  }
});
      </code></pre>
    </div>
  </section>

  <section>
    <div class="left">
      <pre class="javascript"><code>
let sleep = todoModel.addItem('Sleep');
todoModel.addItem('Eat');
todoModel.addItem('Code');
todoModel.addItem('Repeat');

todoModel.toggleItem(sleep.id);

ReactDOM.render(
  &lt;ToDo/&gt;,
  document.getElementById('app')
);
      </code></pre>
    </div>
  </section>

  <section>
    <h3><span class="red">M</span>ore React</h3>
  </section>

  <section>
    <h4>Lifecycle - Mounting</h4>

    <pre class="javascript fragment"><code>
constructor(props)
      </code></pre>

    <pre class="javascript fragment"><code>
getDerivedStateFromProps(nextProps, prevState)
componentWillMount() // legacy
      </code></pre>

    <pre class="javascript fragment"><code>
render()
      </code></pre>

    <pre class="javascript fragment"><code>
componentDidMount()
      </code></pre>
  </section>

  <section>
    <h4>Lifecycle - Updating</h4>

    <pre class="javascript fragment"><code>
getDerivedStateFromProps(nextProps, prevState)
componentWillReceiveProps(nextProps) // legacy
      </code></pre>

    <pre class="javascript fragment"><code>
shouldComponentUpdate(nextProps, nextState)
      </code></pre>

    <pre class="javascript fragment"><code>
componentWillUpdate(nextProps, nextState) // legacy
      </code></pre>

    <pre class="javascript fragment"><code>
render()
      </code></pre>
  </section>

  <section>
    <h4>Lifecycle - Updating</h4>

    <pre class="javascript fragment"><code>
getSnapshotBeforeUpdate(prevProps, prevState)
      </code></pre>

    <pre class="javascript fragment"><code>
componentDidUpdate()
      </code></pre>
  </section>

  <section>
    <h4>Lifecycle - Unmounting</h4>

    <pre class="javascript fragment"><code>
componentWillUnmount()
      </code></pre>
  </section>

  <section>
    <h4>Pure Components</h4>

    <pre class="javascript"><code>
const App = function (props) {
  return &lt;div&gt;{props.title}&lt;/div&gt;;
};

ReactDOM.render(
  &lt;App title=&quot;Next Facebook&quot;/&gt;,
  document.getElementById('app')
);
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript"><code>
function UserGreeting(props) {
  return &lt;h1&gt;Welcome back!&lt;/h1&gt;;
}

function GuestGreeting(props) {
  return &lt;h1&gt;Please sign up.&lt;/h1&gt;;
}
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
function Greeting(props) {
  if (props.isLoggedIn) {
    return &lt;UserGreeting /&gt;;
  }

  return &lt;GuestGreeting /&gt;;
}

ReactDOM.render(
  &lt;Greeting isLoggedIn={false} /&gt;,
  document.getElementById('root')
);
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
function Mailbox(props) {
  return (&lt;div&gt;
    &lt;h1&gt;Hello!&lt;/h1&gt;
    {props.unreadMessages.length &gt; 0 &amp;&amp;
      &lt;h2&gt;
        You have {unreadMessages.length}
          unread messages.
      &lt;/h2&gt;
    }
  &lt;/div&gt;);
}

ReactDOM.render(
  &lt;Mailbox unreadMessages={['Hi', 'Re: Hi']} /&gt;,
  document.getElementById('root')
);
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
render() {
  const isLoggedIn = this.state.isLoggedIn;

  return (
    &lt;div&gt;
      The user is
      &lt;b&gt;{isLoggedIn ? 'currently' : 'not'}&lt;/b&gt;
      logged in.
    &lt;/div&gt;
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
render() {
  const isLoggedIn = this.state.isLoggedIn;

  return (
    &lt;div&gt;
      {isLoggedIn ? (
        &lt;LogoutButton onClick={this.logout} /&gt;
      ) : (
        &lt;LoginButton onClick={this.login} /&gt;
      )}
    &lt;/div&gt;
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
function WarningBanner(props) {
  if (!props.warn) {
    return null;
  }

  return (
    &lt;div className=&quot;warning&quot;&gt;
      Warning!
    &lt;/div&gt;
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Conditional Rendering</h4>

    <pre class="javascript "><code>
class Page extends React.Component {
  render() {
    return (
      &lt;div&gt;
        &lt;WarningBanner
          warn={this.state.showWarning}
        /&gt;

        ...
      &lt;/div&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Composition</h4>

    <pre class="javascript "><code>
function SplitPane(props) {
  return (&lt;div className=&quot;SplitPane&quot;&gt;
    &lt;div className=&quot;SplitPane-left&quot;&gt;
      {props.left}
    &lt;/div&gt;
    &lt;div className=&quot;SplitPane-right&quot;&gt;
      {props.right}
    &lt;/div&gt;
  &lt;/div&gt;);
}

function App() {
  return (
    &lt;SplitPane
      left={&lt;Contacts/&gt;} right={&lt;Chat/&gt;} /&gt;
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Higher-Order Components</h4>

    <pre class="javascript "><code>
const CommentListWithSubscription =
  withSubscription(
    CommentList,
    (DataSource) => DataSource.getComments()
  );

const BlogPostWithSubscription =
  withSubscription(
    BlogPost,
    (DataSource, props) =>
      DataSource.getBlogPost(props.id)
  });
      </code></pre>
  </section>

  <section>
    <h4>Higher-Order Components</h4>

    <pre class="javascript "><code>
function withSubscription(WrappedComponent,
      selectData) {

  return class {
    ...
  };

}
      </code></pre>
  </section>

  <section>
    <h4>Higher-Order Components</h4>

    <pre class="javascript "><code>
constructor(props) {
  super(props);

  this.handleChange = this.handleChange.bind(this);

  this.state = {
    data: selectData(DataSource, props)
  };
}

componentDidMount() {
  DataSource
    .addChangeListener(this.handleChange);
}

componentWillUnmount() {
  DataSource
    .removeChangeListener(this.handleChange);
}
      </code></pre>
  </section>

  <section>
    <h4>Higher-Order Components</h4>

    <pre class="javascript "><code>
handleChange() {
  this.setState({
    data: selectData(DataSource, this.props)
  });
}

render() {
  return &lt;WrappedComponent
    data={this.state.data}
    {...this.props}
  /&gt;;
}
      </code></pre>
  </section>

  <section>
    <h4>Controlled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  constructor(props) {
    super(props);

    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);

    this.state = {value: &#39;&#39;};
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Controlled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  ...
  handleChange(event) {
    this.setState({value: event.target.value});
  }

  handleSubmit(event) {
    alert(
      &#39;A name was submitted: &#39;
      + this.state.value
    );
    event.preventDefault();
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Controlled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  ...
  render() {
    return (
      &lt;form onSubmit={this.handleSubmit}&gt;
        &lt;label&gt;
          Name:
          &lt;input
            type=&quot;text&quot;
            value={this.state.value}
            onChange={this.handleChange}
          /&gt;
        &lt;/label&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
      &lt;/form&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Uncontrolled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  constructor(props) {
    super(props);
    this.handleSubmit = this.handleSubmit.bind(this);
    this.nameRef = React.createRef();
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Uncontrolled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  ...
  handleSubmit(event) {
    alert(
      &#39;A name was submitted: &#39;
      + this.nameRef.current.value
    );
    event.preventDefault();
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Uncontrolled Components</h4>

    <pre class="javascript "><code>
class NameForm extends React.Component {
  ...
  render() {
    return (
      &lt;form onSubmit={this.handleSubmit}&gt;
        &lt;label&gt;
          Name:
          &lt;input
            type=&quot;text&quot;
            ref={this.nameRef}
          /&gt;
        &lt;/label&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
      &lt;/form&gt;
    );
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Uncontrolled Components - Forwarding</h4>

    <pre class="javascript "><code>
const FancyButton = React.forwardRef(
  (props, ref) => (
    &lt;button ref={ref} className="FancyButton"&gt;
      {props.children}
    &lt;/button&gt;
  )
);

// You can now get a ref directly to the DOM button:
const ref = React.createRef();
&lt;FancyButton ref={ref}&gt;Click me!&lt;/FancyButton&gt;;
      </code></pre>
  </section>

  <section>
    <h4>Performance</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  constructor(props) {
    super(props);

    this.state = { l: 0, r: 0}
  }

  render() {
    return [
      &lt;C title=&quot;left&quot; value={this.state.l} /&gt;,
      &lt;C title=&quot;right&quot; value={this.state.r} /&gt;,
    ]
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Performance</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  ...
  componentDidMount() {
    setInterval(() =&gt; {
      const state = { ...this.state };

      if ((state.l + state.r) % 2 === 0) {
        state.l++;
      } else {
        state.r++;
      }

      this.setState(state);
    }, 1000);
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Functional Component</h4>

    <pre class="javascript "><code>
const C = props =&gt; {
  console.log(&#39;Rendering C&#39;, props);

  return (
    &lt;div&gt;
      {props.title}: {props.value}
    &lt;/div&gt;
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Should Update</h4>

    <pre class="javascript "><code>
class C extends React.Component {
  shouldComponentUpdate(nextProps) {
    return nextProps.value !== this.props.value;
  }

  render() {
    console.log(&quot;Rendering C&quot;, this.props);

    return (
      &lt;div&gt;
        {this.props.title}: {this.props.value}
      &lt;/div&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Pure Component</h4>

    <pre class="javascript "><code>
class C extends React.PureComponent {
  render() {
    console.log(&quot;Rendering C&quot;, this.props);

    return (
      &lt;div&gt;
        {this.props.title}: {this.props.value}
      &lt;/div&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Pure Component Failed</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  constructor(props) {
    super(props);

    this.state = { values: [] };
  }

  render() {
    return &lt;C values={this.state.values} /&gt;;
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Pure Component Failed</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  ...
  componentDidMount() {
    setInterval(() =&gt; {
      const state = { ...this.state };

      state.values.push(state.values.length);

      this.setState(state);
    }, 1000);
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Pure Component Failed</h4>

    <pre class="javascript "><code>
class C extends React.PureComponent {
  render() {
    console.log(&quot;Rendering C&quot;, this.props);

    return (
      &lt;div&gt;
        {this.props.values.join(&#39;,&#39;)}
      &lt;/div&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Performance - Memo</h4>

    <pre class="javascript "><code>
// same as PureComponent
const MyComponent = React.memo(function MyComponent(props) {
  /* render using props */
});
      </code></pre>
  </section>

  <section>
    <h4>Performance - Keys</h4>

    <pre class="javascript "><code>
&lt;ul&gt;
  &lt;li&gt;Duke&lt;/li&gt;
  &lt;li&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

&gt;&gt;&gt;

&lt;ul&gt;
  &lt;li&gt;Connecticut&lt;/li&gt;
  &lt;li&gt;Duke&lt;/li&gt;
  &lt;li&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

&gt;&gt;&gt; 2 изменения, 1 создание
      </code></pre>
  </section>

  <section>
    <h4>Performance - Keys</h4>

    <pre class="javascript "><code>
&lt;ul&gt;
  &lt;li key=&quot;2015&quot;&gt;Duke&lt;/li&gt;
  &lt;li key=&quot;2016&quot;&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

&gt;&gt;&gt;

&lt;ul&gt;
  &lt;li key=&quot;2014&quot;&gt;Connecticut&lt;/li&gt;
  &lt;li key=&quot;2015&quot;&gt;Duke&lt;/li&gt;
  &lt;li key=&quot;2016&quot;&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

&gt;&gt;&gt; 1 создание
      </code></pre>
  </section>

  <section>
    <h4>Fragments</h4>

    <pre class="javascript "><code>
class Columns extends React.Component {
  render() {
    return (
      &lt;React.Fragment&gt;
        &lt;td&gt;Hello&lt;/td&gt;
        &lt;td&gt;World&lt;/td&gt;
      &lt;/React.Fragment&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Fragments</h4>

    <pre class="javascript "><code>
class Columns extends React.Component {
  render() {
    return (
      &lt;&gt;
        &lt;td&gt;Hello&lt;/td&gt;
        &lt;td&gt;World&lt;/td&gt;
      &lt;/&gt;
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Portals</h4>

    <pre class="javascript "><code>
render() {
  // React does *not* create a new div.
  // It renders the children into `domNode`.
  // `domNode` is any valid DOM node,
  // regardless of its location in the DOM.
  return ReactDOM.createPortal(
    this.props.children,
    domNode,
  );
}
      </code></pre>
  </section>

  <section>
    <h4>Error Boundaries</h4>

    <pre class="javascript "><code>
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Error Boundaries</h4>

    <pre class="javascript "><code>
class ErrorBoundary extends React.Component {
  ...
  componentDidCatch(error, info) {
    // Display fallback UI
    this.setState({ hasError: true });

    // You can also log the error
    // to an error reporting service
    logErrorToMyService(error, info);
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Error Boundaries</h4>

    <pre class="javascript "><code>
class ErrorBoundary extends React.Component {
  ...
  render() {
    if (this.state.hasError) {
      // You can render any custom fallback UI
      return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;
    }
    return this.props.children;
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Async Set State</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  constructor(props) {
    super(props);

    this.__onClick = this.__onClick.bind(this);

    this.state = { value: 0 };
  }
  ...
}
      </code></pre>
  </section>

  <section>
    <h4>Async Set State</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  ...
  render() {
    return (
      &lt;div onClick={this.__onClick}&gt;
        {this.state.value}
      &lt;/div&gt;
    );
  }

  __onClick() {
    this.setState({ value: this.state.value + 1 });
    this.setState({ value: this.state.value + 1 });
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Async Set State</h4>

    <pre class="javascript "><code>
class App extends React.Component {
  ...
  __onClick() {
    this.setState(state =>
      ({ value: state.value + 1 })
    );

    this.setState(state =>
      ({ value: state.value + 1 })
    );
  }
}
      </code></pre>
  </section>

  <section>
    <h4>Fiber</h4>

    <img src="images/react-fiber-1.png" width="700px">
  </section>

  <section>
    <h4>Fiber</h4>

    <img src="images/react-fiber-2.png" width="700px">
  </section>

  <section>
    <h4>Time Slicing</h4>

    <ul class="left">
      <li class="fragment">приоритеты для задач</li>
      <li class="fragment">пре-рендеринг во время простоя</li>
    </ul>
  </section>

  <section>
    <h4>Suspense</h4>

    <img src="images/suspense.gif" width="700px">
  </section>
</div></div>

<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>
<script src="../js/init-slides.js"></script>
</body>
</html>
